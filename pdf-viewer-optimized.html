<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDFæŸ¥çœ‹å™¨ - ä¼˜åŒ–åŠ è½½ä½“éªŒ</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background: #1a1a2e;
            color: #fff;
            min-height: 100vh;
            overflow: hidden;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1rem 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .toolbar {
            background: #2d2d44;
            padding: 0.75rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
            border-bottom: 1px solid #3d3d5c;
            z-index: 100;
        }

        .btn-group {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        button {
            padding: 0.5rem 1rem;
            background: #3d3d5c;
            color: #fff;
            border: 1px solid #4d4d6c;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        button:hover:not(:disabled) {
            background: #4d4d6c;
            transform: translateY(-1px);
        }

        button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }

        button.primary {
            background: #667eea;
            border-color: #667eea;
        }

        button.primary:hover {
            background: #5a67d8;
        }

        .page-info {
            padding: 0.5rem 1rem;
            background: #3d3d5c;
            border-radius: 6px;
            font-size: 14px;
        }

        .scale-info {
            color: #a0a0c0;
            font-size: 14px;
            padding: 0.5rem;
        }

        /* PDFè§†å£å®¹å™¨ - ä¼˜åŒ– */
        .pdf-viewport {
            flex: 1;
            background: #262637;
            overflow: auto;
            position: relative;
            display: flex;
            justify-content: center;
            padding: 2rem;
        }

        /* å¹³æ»‘æ»šåŠ¨ */
        .pdf-viewport {
            scroll-behavior: smooth;
        }

        .pdf-page-container {
            position: relative;
            margin: 0 auto;
            background: white;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            will-change: transform;
            transition: opacity 0.3s ease;
        }

        /* Canvas å±‚ */
        .pdf-canvas {
            display: block;
            width: 100%;
            height: 100%;
            image-rendering: crisp-edges;
            image-rendering: -webkit-optimize-contrast;
        }

        /* æ–‡æœ¬å±‚ */
        .textLayer {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
            overflow: hidden;
            opacity: 0;
            line-height: 1.0;
            user-select: text;
            -webkit-user-select: text;
            -moz-user-select: text;
            -ms-user-select: text;
        }

        .textLayer > span {
            color: transparent;
            position: absolute;
            white-space: pre;
            cursor: text;
            transform-origin: 0% 0%;
        }

        /* æ–‡æœ¬é«˜äº®é€‰æ‹© */
        .textLayer ::selection {
            background: rgba(0, 124, 255, 0.3);
        }

        /* æ³¨é‡Šå±‚ */
        .annotationLayer {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            bottom: 0;
        }

        .annotationLayer section {
            position: absolute;
            text-align: initial;
        }

        .annotationLayer .linkAnnotation > a,
        .annotationLayer .buttonWidgetAnnotation.pushButton > a {
            position: absolute;
            font-size: 1em;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
        }

        .annotationLayer .linkAnnotation > a:hover,
        .annotationLayer .buttonWidgetAnnotation.pushButton > a:hover {
            opacity: 0.2;
            background: #ff0;
            box-shadow: 0 2px 10px #ff0;
        }

        /* å•ä¸€åŠ è½½æŒ‡ç¤ºå™¨ */
        .loading-indicator {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 46, 0.95);
            border-radius: 12px;
            padding: 2rem 3rem;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            z-index: 10000;
            display: none;
            backdrop-filter: blur(10px);
        }

        .loading-indicator.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 3px solid #3d3d5c;
            border-top-color: #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            color: #fff;
            font-size: 14px;
            text-align: center;
        }

        .loading-progress {
            width: 200px;
            height: 4px;
            background: #3d3d5c;
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .loading-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* åˆå§‹æ¬¢è¿ç•Œé¢ */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2rem;
            padding: 3rem;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .drop-zone {
            border: 2px dashed #4d4d6c;
            border-radius: 12px;
            padding: 4rem;
            text-align: center;
            background: #2d2d44;
            transition: all 0.3s;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: #667eea;
            background: #353548;
            transform: scale(1.02);
        }

        .drop-zone.dragover {
            border-color: #667eea;
            background: #3d3d5c;
            transform: scale(1.05);
        }

        .drop-zone h2 {
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: #fff;
        }

        .drop-zone p {
            color: #a0a0c0;
        }

        .file-input {
            display: none;
        }

        .status-bar {
            background: #1a1a2e;
            padding: 0.5rem 1.5rem;
            font-size: 12px;
            color: #a0a0c0;
            border-top: 1px solid #3d3d5c;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        /* é˜²æ­¢å†…å®¹é—ªçƒ */
        .pdf-viewport.loading {
            pointer-events: none;
        }

        /* é¡µé¢åˆ‡æ¢åŠ¨ç”» */
        @keyframes slideIn {
            from { 
                opacity: 0;
                transform: translateX(20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .pdf-page-container.entering {
            animation: slideIn 0.3s ease;
        }

        /* ä¼˜åŒ–çš„æç¤ºæ¡ */
        .tips {
            background: linear-gradient(90deg, #2d2d44, #3d3d5c);
            padding: 0.75rem 1.5rem;
            color: #ffd700;
            text-align: center;
            font-size: 14px;
            border-bottom: 1px solid #3d3d5c;
            display: none;
        }

        .tips.visible {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“„ Modern PDF Viewer - ä¼˜åŒ–ç‰ˆ</h1>
        </div>

        <div class="tips" id="tips">
            ğŸ’¡ ä½¿ç”¨é¼ æ ‡æ‹–åŠ¨é€‰æ‹©æ–‡æœ¬ï¼ŒCtrl+C å¤åˆ¶ | ä½¿ç”¨æ–¹å‘é”®åˆ‡æ¢é¡µé¢
        </div>

        <div class="toolbar">
            <div class="btn-group">
                <input type="file" id="fileInput" class="file-input" accept=".pdf">
                <button class="primary" onclick="document.getElementById('fileInput').click()">
                    ğŸ“‚ æ‰“å¼€PDF
                </button>
            </div>

            <div class="btn-group">
                <button id="prevPage" disabled>â¬… ä¸Šä¸€é¡µ</button>
                <div class="page-info">
                    <span id="pageNum">0</span> / <span id="pageCount">0</span>
                </div>
                <button id="nextPage" disabled>ä¸‹ä¸€é¡µ â¡</button>
            </div>

            <div class="btn-group">
                <button id="zoomOut">â–</button>
                <span class="scale-info">ç¼©æ”¾: <span id="scalePercent">100%</span></span>
                <button id="zoomIn">â•</button>
                <button id="fitWidth">é€‚åº”å®½åº¦</button>
                <button id="fitPage">é€‚åº”é¡µé¢</button>
            </div>

            <div class="btn-group">
                <button id="rotateBtn">ğŸ”„ æ—‹è½¬</button>
                <button id="downloadBtn" disabled>ğŸ’¾ ä¸‹è½½</button>
            </div>
        </div>

        <div class="pdf-viewport" id="pdfViewport">
            <div class="welcome-screen">
                <div class="drop-zone" id="dropZone">
                    <h2>ğŸ“„ æ‹–æ‹½PDFæ–‡ä»¶åˆ°è¿™é‡Œ</h2>
                    <p>æˆ–ç‚¹å‡»"æ‰“å¼€PDF"æŒ‰é’®é€‰æ‹©æ–‡ä»¶</p>
                    <p style="font-size: 12px; margin-top: 1rem;">æ”¯æŒå¿«é€ŸåŠ è½½ï¼Œæ— é—ªçƒä½“éªŒ</p>
                </div>
            </div>
        </div>

        <div class="status-bar">
            <span id="statusText">å‡†å¤‡å°±ç»ª</span>
            <span id="fileInfo"></span>
        </div>
    </div>

    <!-- å•ä¸€åŠ è½½æŒ‡ç¤ºå™¨ -->
    <div class="loading-indicator" id="loadingIndicator">
        <div class="spinner"></div>
        <div class="loading-text" id="loadingText">æ­£åœ¨åŠ è½½PDF...</div>
        <div class="loading-progress">
            <div class="loading-progress-bar" id="progressBar"></div>
        </div>
    </div>

    <!-- å¼•å…¥ PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <script>
        // é™é»˜é…ç½® PDF.js
        (function() {
            // ä¿å­˜åŸå§‹consoleæ–¹æ³•
            const originalConsole = {
                log: console.log,
                warn: console.warn,
                info: console.info
            };

            // è¿‡æ»¤æ§åˆ¶å°æ¶ˆæ¯
            const filterConsole = (method) => {
                return function(...args) {
                    const message = args[0];
                    if (typeof message === 'string') {
                        // è¿‡æ»¤æ‰æ‰€æœ‰PDF.jsçš„loadingå’Œthumbnailæ¶ˆæ¯
                        if (message.includes('Loading') || 
                            message.includes('thumbnail') || 
                            message.includes('PDF') ||
                            message.includes('Worker') ||
                            message.includes('GetOperatorList') ||
                            message.includes('GetTextContent')) {
                            return;
                        }
                    }
                    originalConsole[method].apply(console, args);
                };
            };

            // åº”ç”¨è¿‡æ»¤å™¨
            console.log = filterConsole('log');
            console.warn = filterConsole('warn');
            console.info = filterConsole('info');
        })();

        // é…ç½® PDF.js Worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // å…¨å±€çŠ¶æ€ç®¡ç†
        const state = {
            pdfDocument: null,
            currentPage: 1,
            currentScale: 1.0,
            currentRotation: 0,
            isRendering: false,
            pendingPage: null,
            fileName: null
        };

        // DOM å…ƒç´ ç¼“å­˜
        const elements = {
            fileInput: document.getElementById('fileInput'),
            prevPage: document.getElementById('prevPage'),
            nextPage: document.getElementById('nextPage'),
            pageNum: document.getElementById('pageNum'),
            pageCount: document.getElementById('pageCount'),
            scalePercent: document.getElementById('scalePercent'),
            pdfViewport: document.getElementById('pdfViewport'),
            dropZone: document.getElementById('dropZone'),
            statusText: document.getElementById('statusText'),
            fileInfo: document.getElementById('fileInfo'),
            zoomIn: document.getElementById('zoomIn'),
            zoomOut: document.getElementById('zoomOut'),
            fitWidth: document.getElementById('fitWidth'),
            fitPage: document.getElementById('fitPage'),
            rotateBtn: document.getElementById('rotateBtn'),
            downloadBtn: document.getElementById('downloadBtn'),
            loadingIndicator: document.getElementById('loadingIndicator'),
            loadingText: document.getElementById('loadingText'),
            progressBar: document.getElementById('progressBar'),
            tips: document.getElementById('tips')
        };

        /**
         * æ˜¾ç¤ºåŠ è½½æŒ‡ç¤ºå™¨
         */
        function showLoading(text = 'æ­£åœ¨åŠ è½½...') {
            elements.loadingIndicator.classList.add('active');
            elements.loadingText.textContent = text;
            elements.progressBar.style.width = '0%';
            elements.pdfViewport.classList.add('loading');
        }

        /**
         * æ›´æ–°åŠ è½½è¿›åº¦
         */
        function updateProgress(percent) {
            elements.progressBar.style.width = `${percent}%`;
            if (percent >= 100) {
                setTimeout(() => {
                    hideLoading();
                }, 300);
            }
        }

        /**
         * éšè—åŠ è½½æŒ‡ç¤ºå™¨
         */
        function hideLoading() {
            elements.loadingIndicator.classList.remove('active');
            elements.pdfViewport.classList.remove('loading');
        }

        /**
         * æ›´æ–°çŠ¶æ€æ 
         */
        function updateStatus(text) {
            elements.statusText.textContent = text;
        }

        /**
         * æ¸²æŸ“PDFé¡µé¢ - ä¼˜åŒ–ç‰ˆ
         */
        async function renderPage(pageNumber) {
            if (!state.pdfDocument || state.isRendering) {
                state.pendingPage = pageNumber;
                return;
            }

            state.isRendering = true;

            try {
                const page = await state.pdfDocument.getPage(pageNumber);
                const rotation = (state.currentRotation + page.rotate) % 360;
                const viewport = page.getViewport({ 
                    scale: state.currentScale,
                    rotation: rotation
                });

                // åˆ›å»ºæˆ–å¤ç”¨å®¹å™¨
                let pageContainer = elements.pdfViewport.querySelector('.pdf-page-container');
                if (!pageContainer) {
                    pageContainer = document.createElement('div');
                    pageContainer.className = 'pdf-page-container';
                    elements.pdfViewport.innerHTML = '';
                    elements.pdfViewport.appendChild(pageContainer);
                }

                // è®¾ç½®å®¹å™¨å°ºå¯¸
                pageContainer.style.width = Math.floor(viewport.width) + 'px';
                pageContainer.style.height = Math.floor(viewport.height) + 'px';

                // åˆ›å»º Canvas
                const canvas = document.createElement('canvas');
                canvas.className = 'pdf-canvas';
                const context = canvas.getContext('2d', { 
                    alpha: false,
                    willReadFrequently: false 
                });
                
                // è®¾ç½® Canvas å°ºå¯¸
                const outputScale = window.devicePixelRatio || 1;
                canvas.width = Math.floor(viewport.width * outputScale);
                canvas.height = Math.floor(viewport.height * outputScale);
                canvas.style.width = Math.floor(viewport.width) + 'px';
                canvas.style.height = Math.floor(viewport.height) + 'px';

                // ä¼˜åŒ–æ¸²æŸ“è´¨é‡
                context.imageSmoothingEnabled = true;
                context.imageSmoothingQuality = 'high';

                // åº”ç”¨ç¼©æ”¾
                const transform = outputScale !== 1 
                    ? [outputScale, 0, 0, outputScale, 0, 0] 
                    : null;

                // æ¸²æŸ“ PDF
                const renderContext = {
                    canvasContext: context,
                    transform: transform,
                    viewport: viewport,
                    background: 'white'
                };

                await page.render(renderContext).promise;

                // åˆ›å»ºæ–‡æœ¬å±‚
                const textLayerDiv = document.createElement('div');
                textLayerDiv.className = 'textLayer';

                const textContent = await page.getTextContent();
                const textLayerFragment = document.createDocumentFragment();
                const textDivs = [];

                await pdfjsLib.renderTextLayer({
                    textContentSource: textContent,
                    container: textLayerDiv,
                    viewport: viewport,
                    textDivs: textDivs,
                    enhanceTextSelection: true
                }).promise;

                // åˆ›å»ºæ³¨é‡Šå±‚
                const annotationLayerDiv = document.createElement('div');
                annotationLayerDiv.className = 'annotationLayer';

                const annotations = await page.getAnnotations();
                if (annotations.length > 0) {
                    pdfjsLib.AnnotationLayer.render({
                        viewport: viewport.clone({ dontFlip: true }),
                        div: annotationLayerDiv,
                        annotations: annotations,
                        page: page,
                        linkService: {
                            getDestinationHash: () => '#',
                            getAnchorUrl: () => '#',
                            navigateTo: () => {},
                            executeNamedAction: () => {}
                        }
                    });
                }

                // å¹³æ»‘æ›¿æ¢å†…å®¹ - æ— æŠ–åŠ¨ç‰ˆæœ¬
                pageContainer.innerHTML = '';
                pageContainer.appendChild(canvas);
                pageContainer.appendChild(textLayerDiv);
                pageContainer.appendChild(annotationLayerDiv);
                
                // æ·¡å…¥æ•ˆæœ
                pageContainer.style.transition = 'opacity 0.3s ease';
                pageContainer.style.opacity = '0.5';
                requestAnimationFrame(() => {
                    pageContainer.style.opacity = '1';
                });

                // æ›´æ–°UI
                state.currentPage = pageNumber;
                elements.pageNum.textContent = pageNumber;
                updateButtons();
                updateStatus('å°±ç»ª');

            } catch (error) {
                console.error('æ¸²æŸ“é”™è¯¯:', error);
                updateStatus('æ¸²æŸ“å¤±è´¥');
            } finally {
                state.isRendering = false;
                
                // å¤„ç†å¾…æ¸²æŸ“é¡µé¢
                if (state.pendingPage !== null && state.pendingPage !== pageNumber) {
                    const nextPage = state.pendingPage;
                    state.pendingPage = null;
                    renderPage(nextPage);
                }
            }
        }

        /**
         * æ›´æ–°æŒ‰é’®çŠ¶æ€
         */
        function updateButtons() {
            elements.prevPage.disabled = state.currentPage <= 1;
            elements.nextPage.disabled = !state.pdfDocument || state.currentPage >= state.pdfDocument.numPages;
            elements.downloadBtn.disabled = !state.pdfDocument;
            elements.scalePercent.textContent = Math.round(state.currentScale * 100) + '%';
        }

        /**
         * åŠ è½½PDFæ–‡ä»¶ - ä¼˜åŒ–ç‰ˆ
         */
        async function loadPDF(file) {
            state.fileName = file.name;
            elements.fileInfo.textContent = file.name;
            
            showLoading('æ­£åœ¨è¯»å–æ–‡ä»¶...');
            
            const fileReader = new FileReader();
            
            fileReader.onload = async function() {
                try {
                    const typedArray = new Uint8Array(this.result);
                    
                    showLoading('æ­£åœ¨è§£æPDF...');
                    
                    // åŠ è½½PDFæ–‡æ¡£ï¼Œç¦ç”¨å†—ä½™æ—¥å¿—
                    const loadingTask = pdfjsLib.getDocument({
                        data: typedArray,
                        cMapUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/cmaps/',
                        cMapPacked: true,
                        standardFontDataUrl: 'https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/standard_fonts/',
                        verbosity: 0,  // é™é»˜æ¨¡å¼
                        stopAtErrors: false,
                        disableFontFace: false,
                        enableXfa: true
                    });
                    
                    // ç›‘å¬åŠ è½½è¿›åº¦
                    loadingTask.onProgress = function(data) {
                        const percent = data.total > 0 
                            ? Math.round((data.loaded / data.total) * 100)
                            : 50;
                        updateProgress(percent);
                        elements.loadingText.textContent = `æ­£åœ¨åŠ è½½PDF... ${percent}%`;
                    };
                    
                    state.pdfDocument = await loadingTask.promise;
                    
                    // æ›´æ–°é¡µæ•°
                    elements.pageCount.textContent = state.pdfDocument.numPages;
                    
                    // é‡ç½®çŠ¶æ€
                    state.currentPage = 1;
                    state.currentScale = 1.0;
                    state.currentRotation = 0;
                    
                    // æ˜¾ç¤ºæç¤º
                    elements.tips.classList.add('visible');
                    setTimeout(() => {
                        elements.tips.classList.remove('visible');
                    }, 5000);
                    
                    // æ¸²æŸ“ç¬¬ä¸€é¡µ
                    await renderPage(1);
                    
                    updateProgress(100);
                    updateStatus(`å·²åŠ è½½: ${file.name} (å…± ${state.pdfDocument.numPages} é¡µ)`);
                    
                } catch (error) {
                    console.error('PDFåŠ è½½å¤±è´¥:', error);
                    updateStatus(`åŠ è½½å¤±è´¥: ${error.message}`);
                    hideLoading();
                }
            };
            
            fileReader.readAsArrayBuffer(file);
        }

        /**
         * å¯¼èˆªåŠŸèƒ½
         */
        function previousPage() {
            if (state.currentPage > 1) {
                renderPage(state.currentPage - 1);
            }
        }

        function nextPage() {
            if (state.pdfDocument && state.currentPage < state.pdfDocument.numPages) {
                renderPage(state.currentPage + 1);
            }
        }

        /**
         * ç¼©æ”¾åŠŸèƒ½
         */
        function zoomIn() {
            state.currentScale = Math.min(state.currentScale * 1.25, 5.0);
            renderPage(state.currentPage);
        }

        function zoomOut() {
            state.currentScale = Math.max(state.currentScale / 1.25, 0.25);
            renderPage(state.currentPage);
        }

        async function fitWidth() {
            if (!state.pdfDocument) return;
            const page = await state.pdfDocument.getPage(state.currentPage);
            const viewport = page.getViewport({ scale: 1.0 });
            const containerWidth = elements.pdfViewport.clientWidth - 80;
            state.currentScale = containerWidth / viewport.width;
            renderPage(state.currentPage);
        }

        async function fitPage() {
            if (!state.pdfDocument) return;
            const page = await state.pdfDocument.getPage(state.currentPage);
            const viewport = page.getViewport({ scale: 1.0 });
            const containerWidth = elements.pdfViewport.clientWidth - 80;
            const containerHeight = elements.pdfViewport.clientHeight - 80;
            state.currentScale = Math.min(
                containerWidth / viewport.width,
                containerHeight / viewport.height
            );
            renderPage(state.currentPage);
        }

        /**
         * æ—‹è½¬åŠŸèƒ½
         */
        function rotatePage() {
            state.currentRotation = (state.currentRotation + 90) % 360;
            renderPage(state.currentPage);
        }

        /**
         * ä¸‹è½½åŠŸèƒ½
         */
        function downloadPDF() {
            if (state.pdfDocument && state.fileName) {
                const link = document.createElement('a');
                link.href = URL.createObjectURL(new Blob([state.pdfDocument._pdfInfo.data], { type: 'application/pdf' }));
                link.download = state.fileName;
                link.click();
            }
        }

        /**
         * äº‹ä»¶ç»‘å®š
         */
        elements.fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && file.type === 'application/pdf') {
                loadPDF(file);
            }
        });

        elements.prevPage.addEventListener('click', previousPage);
        elements.nextPage.addEventListener('click', nextPage);
        elements.zoomIn.addEventListener('click', zoomIn);
        elements.zoomOut.addEventListener('click', zoomOut);
        elements.fitWidth.addEventListener('click', fitWidth);
        elements.fitPage.addEventListener('click', fitPage);
        elements.rotateBtn.addEventListener('click', rotatePage);
        elements.downloadBtn.addEventListener('click', downloadPDF);

        // æ‹–æ‹½åŠŸèƒ½
        elements.dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            elements.dropZone.classList.add('dragover');
        });

        elements.dropZone.addEventListener('dragleave', () => {
            elements.dropZone.classList.remove('dragover');
        });

        elements.dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            elements.dropZone.classList.remove('dragover');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type === 'application/pdf') {
                loadPDF(file);
            }
        });

        // ç‚¹å‡»æ‹–æ”¾åŒºåŸŸæ‰“å¼€æ–‡ä»¶
        elements.dropZone.addEventListener('click', () => {
            elements.fileInput.click();
        });

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            if (!state.pdfDocument) return;
            
            switch(e.key) {
                case 'ArrowLeft':
                    previousPage();
                    break;
                case 'ArrowRight':
                    nextPage();
                    break;
                case '+':
                case '=':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        zoomIn();
                    }
                    break;
                case '-':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        zoomOut();
                    }
                    break;
                case '0':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        state.currentScale = 1.0;
                        renderPage(state.currentPage);
                    }
                    break;
                case 'r':
                    if (e.ctrlKey || e.metaKey) {
                        e.preventDefault();
                        rotatePage();
                    }
                    break;
            }
        });

        // åˆå§‹åŒ–
        updateStatus('å‡†å¤‡å°±ç»ª');
        updateButtons();
    </script>
</body>
</html>